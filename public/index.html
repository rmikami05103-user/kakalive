<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>平面駐車場ライブ配信（テスト配信中）</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="./assets/styles.css" />
</head>
<body>
  <div class="container">
    <h1>平面駐車場ライブ配信（テスト配信中）</h1>
    <div class="small">
      病院駐車場の現在状況（画角内）と、周辺駐車場（OpenStreetMap）を参考表示します。
    </div>

    <!-- 1) YouTubeライブ -->
    <section class="card" style="margin-top:12px;">
      <h2>ライブ配信</h2>
      <div class="player-wrap">
        <iframe id="ytPlayer" class="player" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>

      <div class="controls">
        <button id="btnReload" class="primary">再読み込み（つなぎ直し）</button>
        <a id="btnOpenYouTube" class="btn" target="_blank" rel="noopener">YouTubeで開く</a>
      </div>
      <div class="small" id="ytInfo"></div>
    </section>

    <!-- 2) 駐車場検索＆近い順リスト -->
    <section class="card">
      <h2>近隣駐車場マップ</h2>
      <div class="legend">
        <span class="badge rec">病院推奨</span>
        <span class="badge">周辺駐車場（OSM）</span>
        <span class="badge fallback" id="fallbackBadge" style="display:none;">0件のため範囲拡張（2500m）</span>
      </div>

      <div class="small" id="nearbyMeta">
        半径 1200m（徒歩圏）を検索します。0件の場合のみ自動で 2500m に拡張します。
      </div>

      <div class="row" style="margin-top:10px;">
        <div class="col">
          <div id="nearbyMap" class="map"></div>
        </div>

        <div class="col">
          <div class="small">近い順（上位10件）</div>
          <div id="nearbyList" class="list" style="margin-top:10px;"></div>
          <div class="small" id="nearbyErr" style="margin-top:10px;"></div>
        </div>
      </div>
    </section>

    <!-- 3) ダッシュボード（今はダミー。将来の混雑インジケータ＆模式図） -->
    <section class="card" id="dashboardSection">
      <h2>ダッシュボード（試作）</h2>

      <div class="row">
        <div class="col">
          <div class="small">駐車場 混雑インジケータ（ダミー表示）</div>
          <div style="margin-top:10px;">
            <div style="display:flex; align-items:center; justify-content:space-between;">
              <div class="small">状態：<span id="congestionLabel">—</span></div>
              <div style="font-weight:700;"><span id="congestionPct">—</span>%</div>
            </div>
            <div style="height:10px; background:#eee; border-radius:999px; overflow:hidden; margin-top:8px;">
              <div id="congestionBar" style="height:100%; width:0%; background:var(--warn);"></div>
            </div>
            <div class="small" style="margin-top:10px;">
              空き: <span id="freeCount">—</span> / <span id="totalCount">—</span><br>
              最終更新: <span id="dashUpdatedAt">—</span>
            </div>
          </div>
        </div>

        <div class="col">
          <div class="small">空き状況（模式図／ダミー）</div>
          <div id="schematic" style="margin-top:10px; display:grid; grid-template-columns:repeat(10, 1fr); gap:6px;"></div>
          <div class="small" style="margin-top:8px;">※模式図（カメラ画角内）</div>
        </div>
      </div>
    </section>

    <!-- 4) 注釈 -->
    <section class="card" id="notesSection">
      <h2>表示について</h2>
      <ul class="small" style="margin:0; padding-left:18px;">
        <li>混雑%と模式図は「画角内（主要エリア）」を対象とします。</li>
        <li>周辺駐車場情報は OpenStreetMap の公開データを参照します。記載の有無や内容は最新でない場合があります。</li>
        <li>更新が止まる場合は、再読み込み（つなぎ直し）をお試しください。</li>
      </ul>
    </section>

  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="./assets/app.js"></script>
</body>
</html>
